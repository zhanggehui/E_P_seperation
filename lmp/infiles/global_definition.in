### group definition ########################################################
group gra type 1:4
group go type 1:11
group walls type 16
group water type 12 13

group control_atoms union gra walls
group free_atoms subtract all control_atoms
group control_atoms delete

variable gra_zhi equal bound(gra,zmax)
variable gra_zlo equal bound(gra,zmin)
region up_box block EDGE EDGE EDGE EDGE $(v_gra_zhi) EDGE
region low_box block EDGE EDGE EDGE EDGE EDGE $(v_gra_zlo)

### wall group ###
variable g_atom_v atom grmask(walls,up_box)
group up_wall variable g_atom_v

variable g_atom_v atom grmask(walls,low_box) 
group low_wall variable g_atom_v

### sol group ###
group sol subtract all go walls
variable g_atom_v atom grmask(sol,up_box)
group up_sol variable g_atom_v
group up_sol include molecule

variable g_atom_v atom grmask(sol,low_box)
group low_sol variable g_atom_v
group low_sol include molecule

group mid_sol subtract sol up_sol low_sol
group sol delete

### define compute #######################################
variable up_wall_z equal bound(up_wall,zmax)
variable low_wall_z equal bound(low_wall,zmin)

variable xy_area equal lx*ly
variable f_upwall equal fcm(up_wall,z)
variable f_lowwall equal fcm(low_wall,z)
variable p_ratio equal 1.013*6.022*1e-5/4.186
variable p_up equal v_f_upwall/(v_xy_area*v_p_ratio)
variable p_low equal v_f_lowwall/(v_xy_area*v_p_ratio)

variable den_ratio equal 10/6.022
variable up_vol equal "(v_up_wall_z-v_gra_zhi)/lz*vol"
variable low_vol equal "(v_gra_zlo-v_low_wall_z)/lz*vol"
variable den_up equal mass(up_sol)/v_up_vol*v_den_ratio
variable den_low equal mass(low_sol)/v_low_vol*v_den_ratio

thermo_style custom step temp etotal press v_p_up v_p_low v_den_up v_den_low vol
